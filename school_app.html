<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>í•™êµë³„ ì§€ì›ì í˜„í™©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --danger-color: #ef4444;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-bg);
            padding: 20px;
            margin: 0;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 20px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--light-bg);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .chip label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: #fff;
            font-size: 0.95rem;
            min-width: 200px;
            cursor: pointer;
        }

        /* Stats Bar */
        .stats-bar {
            background: var(--card-bg);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-item .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* ëª¨ì§‘ì¸ì› ìŠ¤íƒ€ì¼ */
        .stat-item .value.quota {
            color: #7c3aed;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #a78bfa;
        }

        /* ì´ì§€ì›ì ê²½ìŸë¥ ë³„ ìŠ¤íƒ€ì¼ */
        .stat-item .value.competition-low {
            color: #059669;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #34d399;
        }

        .stat-item .value.competition-normal {
            color: #2563eb;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #60a5fa;
        }

        .stat-item .value.competition-high {
            color: #d97706;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #fbbf24;
        }

        .stat-item .value.competition-extreme {
            color: #dc2626;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #f87171;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0); }
        }

        /* Applicants Table */
        .applicants-table-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .applicants-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .applicants-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .applicants-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            white-space: nowrap;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .applicants-table th:last-child {
            border-right: none;
        }

        .applicants-table tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }

        .applicants-table tbody tr:hover {
            background-color: var(--light-bg);
        }

        .applicants-table td {
            padding: 10px 8px;
            text-align: center;
            border-right: 1px solid var(--border-color);
        }

        .applicants-table td:last-child {
            border-right: none;
        }

        .applicants-table .rank-cell {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .applicants-table .name-cell {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .applicants-table .total-cell {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.05rem;
        }

        .applicants-table .practical-records {
            text-align: left;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .applicants-table .practical-records div {
            white-space: nowrap;
        }

        /* Applicant Card - Compact */
        .applicants-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .applicant-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .applicant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px -2px rgba(0, 0, 0, 0.15);
        }

        /* ë‚´ ì§€ì  ê°•ì¡° */
        .applicant-card.my-branch {
            background: linear-gradient(to right, #fffbeb 0%, #ffffff 100%);
            border: 2px solid #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .applicant-card.my-branch .card-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .applicant-card.my-branch .card-header .branch {
            font-weight: 700;
            opacity: 1;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 16px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }

        .card-header .rank {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 40px;
        }

        .card-header .name {
            font-weight: 700;
            font-size: 1.05rem;
        }

        .card-header .branch {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .card-header .school {
            opacity: 0.85;
            font-size: 0.85rem;
            margin-left: auto;
        }

        .card-body {
            padding: 12px 16px;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .compact-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            flex-wrap: wrap;
        }

        .compact-row .label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .compact-row .content {
            color: var(--text-primary);
            flex: 1;
        }

        .score-item {
            display: inline-block;
            margin-right: 12px;
            white-space: nowrap;
        }

        .score-item:last-child {
            margin-right: 0;
        }

        .total-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 16px;
            font-weight: 600;
        }

        .total-row .item {
            flex: 1;
        }

        .total-row .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
        }

        .total-row .value {
            font-size: 1.05rem;
            color: var(--primary-color);
        }

        .total-row .value.highlight {
            font-size: 1.2rem;
            font-weight: 700;
        }

        /* Grade Text - No Background */
        .grade-text {
            font-weight: 600;
        }

        .grade-1, .grade-2 { color: #166534; }
        .grade-3, .grade-4 { color: #1e40af; }
        .grade-5, .grade-6 { color: #92400e; }
        .grade-7, .grade-8, .grade-9 { color: #991b1b; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--border-color);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin: 0 0 8px 0;
        }

        .empty-state p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 2rem;
            color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .applicants-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: stretch;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .stats-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-university"></i>
                í•™êµë³„ ì§€ì›ì í˜„í™©
            </h1>
            <div class="header-controls">
                <div class="chip">
                    <label for="year-select">ì—°ë„</label>
                    <select id="year-select">
                        <option value="2026">2026í•™ë…„ë„</option>
                        <option value="2025">2025í•™ë…„ë„</option>
                    </select>
                </div>
                <div class="chip">
                    <label for="gun-select">
                        <i class="fas fa-flag"></i>
                        ëª¨ì§‘êµ°
                    </label>
                    <select id="gun-select">
                        <option value="">ëª¨ì§‘êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ê°€">ê°€êµ°</option>
                        <option value="ë‚˜">ë‚˜êµ°</option>
                        <option value="ë‹¤">ë‹¤êµ°</option>
                    </select>
                </div>
                <div class="chip">
                    <label for="university-select">
                        <i class="fas fa-school"></i>
                        ëŒ€í•™ ì„ íƒ
                    </label>
                    <select id="university-select" disabled>
                        <option value="">ë¨¼ì € ëª¨ì§‘êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" id="stats-bar" style="display: none;">
            <div class="stat-item">
                <div class="label">ëª¨ì§‘ì¸ì›</div>
                <div class="value" id="quota-count">0ëª…</div>
            </div>
            <div class="stat-item">
                <div class="label">ì´ ì§€ì›ì</div>
                <div class="value" id="total-applicants">0ëª…</div>
            </div>
            <div class="stat-item">
                <div class="label">í‰ê·  ìˆ˜ëŠ¥</div>
                <div class="value" id="avg-suneung">0ì </div>
            </div>
            <div class="stat-item">
                <div class="label">ìˆ˜ëŠ¥ ìµœê³ ì </div>
                <div class="value" id="max-suneung">0ì </div>
            </div>
            <div class="stat-item">
                <div class="label">ìˆ˜ëŠ¥ ìµœì €ì </div>
                <div class="value" id="min-suneung">0ì </div>
            </div>
            <div class="stat-item">
                <div class="label">í‰ê·  ì´ì </div>
                <div class="value" id="avg-total">0ì </div>
            </div>
            <div class="stat-item">
                <div class="label">ì´ì  ìµœê³ </div>
                <div class="value" id="max-total">0ì </div>
            </div>
            <div class="stat-item">
                <div class="label">ì´ì  ìµœì €</div>
                <div class="value" id="min-total">0ì </div>
            </div>
            <div class="chip" style="margin-left: auto;">
                <label for="sort-select">
                    <i class="fas fa-sort"></i>
                    ì •ë ¬
                </label>
                <select id="sort-select">
                    <option value="total_score">ì´ì  ë†’ì€ ìˆœ</option>
                    <option value="suneung_score">ìˆ˜ëŠ¥ì ìˆ˜ ë†’ì€ ìˆœ</option>
                    <option value="naeshin_score">ë‚´ì‹ ì ìˆ˜ ë†’ì€ ìˆœ</option>
                    <option value="practical_score">ì‹¤ê¸°ì ìˆ˜ ë†’ì€ ìˆœ</option>
                    <option value="name">ì´ë¦„ ìˆœ</option>
                </select>
            </div>
        </div>

        <!-- Applicants Grid -->
        <div id="applicants-container">
            <div class="empty-state">
                <i class="fas fa-flag"></i>
                <h3>ëª¨ì§‘êµ°ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <p>ë¨¼ì € ëª¨ì§‘êµ°ì„ ì„ íƒí•œ í›„ ëŒ€í•™ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í•™êµ ì§€ì›ì ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        const SVR_JUNGSI = 'https://supermax.kr';
        const LOGIN_PAGE = 'jungsilogin.html';

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì§€ì›ì ë°ì´í„° ì €ì¥
        let currentApplicants = [];
        let currentStats = {};

        function getToken() {
            return localStorage.getItem('jwt_token');
        }

        function getBranchFromToken() {
            const token = getToken();
            if (!token) return null;
            try {
                const payloadBase64Url = token.split('.')[1];
                const payloadBase64 = payloadBase64Url.replace(/-/g, '+').replace(/_/g, '/');
                const binaryString = atob(payloadBase64);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                const decodedString = new TextDecoder().decode(bytes);
                const decoded = JSON.parse(decodedString);
                return decoded.branch || null;
            } catch (e) {
                console.error('í† í° íŒŒì‹± ì‹¤íŒ¨:', e);
                return null;
            }
        }

        async function loadUniversityList(year, gun) {
            const token = getToken();
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = LOGIN_PAGE;
                return;
            }

            console.log('ğŸ” loadUniversityList í˜¸ì¶œ:', { year, gun });

            if (!gun) {
                const universitySelect = document.getElementById('university-select');
                universitySelect.disabled = true;
                universitySelect.innerHTML = '<option value="">ë¨¼ì € ëª¨ì§‘êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                return;
            }

            try {
                console.log('ğŸ“¡ API í˜¸ì¶œ:', `${SVR_JUNGSI}/jungsi/schools/${year}`);
                const res = await fetch(`${SVR_JUNGSI}/jungsi/schools/${year}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', res.status, res.statusText);

                if (!res.ok) {
                    throw new Error('ëŒ€í•™ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const data = await res.json();
                console.log('ğŸ“¦ ë°›ì€ ë°ì´í„°:', data);
                console.log('ğŸ“¦ list ë°°ì—´:', data.list);
                console.log('ğŸ“¦ list íƒ€ì…:', typeof data.list, Array.isArray(data.list));

                const universitySelect = document.getElementById('university-select');
                universitySelect.innerHTML = '<option value="">ëŒ€í•™ì„ ì„ íƒí•˜ì„¸ìš”</option>';

                if (data.success && Array.isArray(data.list)) {
                    console.log('âœ… ì „ì²´ ëŒ€í•™ ìˆ˜:', data.list.length);

                    // ì„ íƒí•œ êµ°ì— í•´ë‹¹í•˜ëŠ” ëŒ€í•™ë§Œ í•„í„°ë§
                    const filteredSchools = data.list.filter(uni => {
                        console.log(`ğŸ” ëŒ€í•™: ${uni.university} - ${uni.department}, êµ°: "${uni.gun}" === "${gun}"?`, uni.gun === gun);
                        return uni.gun === gun;
                    });

                    console.log('âœ… í•„í„°ë§ëœ ëŒ€í•™ ìˆ˜:', filteredSchools.length);

                    if (filteredSchools.length === 0) {
                        console.warn('âš ï¸ í•´ë‹¹ ëª¨ì§‘êµ°ì— ëŒ€í•™ì´ ì—†ìŠµë‹ˆë‹¤');
                        universitySelect.innerHTML = '<option value="">í•´ë‹¹ ëª¨ì§‘êµ°ì— ëŒ€í•™ì´ ì—†ìŠµë‹ˆë‹¤</option>';
                        universitySelect.disabled = true;
                        return;
                    }

                    filteredSchools.forEach(uni => {
                        const option = document.createElement('option');
                        option.value = uni.U_ID;
                        option.textContent = `${uni.university} - ${uni.department}`;
                        option.dataset.universityName = uni.university;
                        option.dataset.major = uni.department;
                        universitySelect.appendChild(option);
                    });

                    universitySelect.disabled = false;
                    console.log('âœ… ëŒ€í•™ ëª©ë¡ ë¡œë“œ ì™„ë£Œ');
                } else {
                    console.error('âŒ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜:', data);
                }
            } catch (error) {
                console.error('âŒ ëŒ€í•™ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ëŒ€í•™ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function loadApplicantsForUniversity(U_ID, year) {
            const token = getToken();

            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = LOGIN_PAGE;
                return;
            }

            const container = document.getElementById('applicants-container');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><br>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            try {
                // ìƒˆë¡œìš´ ë°±ì—”ë“œ API ì‚¬ìš©
                const res = await fetch(`${SVR_JUNGSI}/jungsi/university-applicants/${U_ID}/${year}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) {
                    throw new Error('ì§€ì›ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const data = await res.json();

                if (data.success) {
                    displayApplicants(data.applicants, data.stats, data.university);
                } else {
                    throw new Error(data.message || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ì§€ì›ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                document.getElementById('stats-bar').style.display = 'none';
            }
        }

        function sortApplicants(sortBy) {
            const sorted = [...currentApplicants];

            switch(sortBy) {
                case 'total_score':
                    sorted.sort((a, b) => (b.total_score || 0) - (a.total_score || 0));
                    break;
                case 'suneung_score':
                    sorted.sort((a, b) => (b.suneung_score || 0) - (a.suneung_score || 0));
                    break;
                case 'naeshin_score':
                    sorted.sort((a, b) => (b.naeshin_score || 0) - (a.naeshin_score || 0));
                    break;
                case 'practical_score':
                    sorted.sort((a, b) => (b.practical_score || 0) - (a.practical_score || 0));
                    break;
                case 'name':
                    sorted.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ko-KR'));
                    break;
            }

            renderApplicantCards(sorted);
        }

        function displayApplicants(applicants, stats, university) {
            const container = document.getElementById('applicants-container');
            const statsBar = document.getElementById('stats-bar');

            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            currentApplicants = applicants || [];
            currentStats = stats || {};
            const quota = university?.quota || 0;

            if (!applicants || applicants.length === 0) {
                statsBar.style.display = 'none';
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í•´ë‹¹ ëŒ€í•™ì— ì§€ì›í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // ìˆ˜ëŠ¥ ì ìˆ˜ í†µê³„ ê³„ì‚°
            const suneungScores = applicants.map(a => a.suneung_score || 0).filter(s => s > 0);
            const avgSuneung = suneungScores.length > 0 ? (suneungScores.reduce((sum, s) => sum + s, 0) / suneungScores.length) : 0;
            const maxSuneung = suneungScores.length > 0 ? Math.max(...suneungScores) : 0;
            const minSuneung = suneungScores.length > 0 ? Math.min(...suneungScores) : 0;

            // í†µê³„ í‘œì‹œ
            statsBar.style.display = 'flex';

            // ëª¨ì§‘ì¸ì› ìŠ¤íƒ€ì¼ ì ìš©
            const quotaEl = document.getElementById('quota-count');
            quotaEl.textContent = `${quota}ëª…`;
            quotaEl.className = 'value quota';

            // ì´ì§€ì›ì - ê²½ìŸë¥ ì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½
            const totalEl = document.getElementById('total-applicants');
            const totalCount = stats.total_count || 0;
            totalEl.textContent = `${totalCount}ëª…`;

            // ê²½ìŸë¥  ê³„ì‚° ë° í´ë˜ìŠ¤ ì ìš©
            let competitionClass = 'value';
            if (quota > 0) {
                const ratio = totalCount / quota;
                if (ratio < 1) {
                    competitionClass = 'value competition-low';  // ë¯¸ë‹¬ (ì´ˆë¡)
                } else if (ratio < 2) {
                    competitionClass = 'value competition-normal';  // 1~2ë°° (íŒŒë‘)
                } else if (ratio < 3) {
                    competitionClass = 'value competition-high';  // 2~3ë°° (ì£¼í™©)
                } else {
                    competitionClass = 'value competition-extreme';  // 3ë°° ì´ìƒ (ë¹¨ê°• + ì• ë‹ˆë©”ì´ì…˜)
                }
            }
            totalEl.className = competitionClass;
            document.getElementById('avg-suneung').textContent = `${avgSuneung.toFixed(2)}ì `;
            document.getElementById('max-suneung').textContent = `${maxSuneung.toFixed(2)}ì `;
            document.getElementById('min-suneung').textContent = `${minSuneung.toFixed(2)}ì `;
            document.getElementById('avg-total').textContent = `${stats.avg_score.toFixed(2)}ì `;
            document.getElementById('max-total').textContent = `${stats.max_score.toFixed(2)}ì `;
            document.getElementById('min-total').textContent = `${stats.min_score.toFixed(2)}ì `;

            // ì´ˆê¸° ì •ë ¬ ì ìš©
            const sortSelect = document.getElementById('sort-select');
            sortApplicants(sortSelect.value);
        }

        function renderApplicantCards(applicants) {
            const container = document.getElementById('applicants-container');
            const myBranch = getBranchFromToken(); // ë‚´ ì§€ì  ì •ë³´ ê°€ì ¸ì˜¤ê¸°

            // ì»´íŒ©íŠ¸ ì¹´ë“œ ìƒì„±
            const cardsHTML = applicants.map((applicant, index) => {
                const rank = index + 1;
                const isMyBranch = myBranch && applicant.branch === myBranch; // ë‚´ ì§€ì  í•™ìƒì¸ì§€ í™•ì¸

                // ìˆ˜ëŠ¥ ì„±ì  í…ìŠ¤íŠ¸ ìƒì„± (ê°„ê²°í•œ í˜•ì‹)
                const suneungScores = [
                    `êµ­ì–´ í‘œ${applicant.korean_standard || '-'} ë°±${applicant.korean_percentile || '-'} <span class="grade-text grade-${applicant.korean_grade || '9'}">ë“±${applicant.korean_grade || '-'}</span>`,
                    `ìˆ˜í•™ í‘œ${applicant.math_standard || '-'} ë°±${applicant.math_percentile || '-'} <span class="grade-text grade-${applicant.math_grade || '9'}">ë“±${applicant.math_grade || '-'}</span>`,
                    `ì˜ì–´ <span class="grade-text grade-${applicant.english_grade || '9'}">ë“±${applicant.english_grade || '-'}</span>`,
                    `íƒêµ¬1 í‘œ${applicant.inquiry1_standard || '-'} ë°±${applicant.inquiry1_percentile || '-'} <span class="grade-text grade-${applicant.inquiry1_grade || '9'}">ë“±${applicant.inquiry1_grade || '-'}</span>`,
                    `íƒêµ¬2 í‘œ${applicant.inquiry2_standard || '-'} ë°±${applicant.inquiry2_percentile || '-'} <span class="grade-text grade-${applicant.inquiry2_grade || '9'}">ë“±${applicant.inquiry2_grade || '-'}</span>`
                ].map(s => `<span class="score-item">${s}</span>`).join('');

                // ì‹¤ê¸° ê¸°ë¡ í…ìŠ¤íŠ¸ ìƒì„±
                let practicalText = '-';
                if (applicant.practical_records && typeof applicant.practical_records === 'object' && Object.keys(applicant.practical_records).length > 0) {
                    practicalText = Object.entries(applicant.practical_records)
                        .map(([ì¢…ëª©ëª…, ê¸°ë¡]) => `${ì¢…ëª©ëª…} ${ê¸°ë¡}`)
                        .join(', ');
                }

                return `
                    <div class="applicant-card ${isMyBranch ? 'my-branch' : ''}">
                        <div class="card-header">
                            <span class="rank">#${rank}</span>
                            <span class="name">${applicant.name || '-'}</span>
                            <span class="branch">| ${applicant.branch || '-'}</span>
                            <span class="school">${applicant.school_name || '-'}</span>
                        </div>
                        <div class="card-body">
                            <div class="compact-row">
                                <span class="label">ìˆ˜ëŠ¥</span>
                                <span class="content">${suneungScores}</span>
                            </div>
                            ${practicalText !== '-' ? `
                            <div class="compact-row">
                                <span class="label">ì‹¤ê¸°</span>
                                <span class="content">${practicalText}</span>
                            </div>
                            ` : ''}
                            <div class="total-row">
                                <div class="item">
                                    <span class="label">ìˆ˜ëŠ¥ì ìˆ˜</span>
                                    <span class="value">${applicant.suneung_score?.toFixed(2) || '-'}</span>
                                </div>
                                ${applicant.naeshin_score ? `
                                <div class="item">
                                    <span class="label">ë‚´ì‹ </span>
                                    <span class="value">${applicant.naeshin_score.toFixed(2)}</span>
                                </div>
                                ` : ''}
                                ${applicant.practical_score ? `
                                <div class="item">
                                    <span class="label">ì‹¤ê¸°</span>
                                    <span class="value">${applicant.practical_score.toFixed(2)}</span>
                                </div>
                                ` : ''}
                                <div class="item">
                                    <span class="label">ì´ì </span>
                                    <span class="value highlight">${applicant.total_score?.toFixed(2) || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="applicants-grid">${cardsHTML}</div>`;
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const token = getToken();
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = LOGIN_PAGE;
                return;
            }

            const yearSelect = document.getElementById('year-select');
            const gunSelect = document.getElementById('gun-select');
            const universitySelect = document.getElementById('university-select');
            const sortSelect = document.getElementById('sort-select');

            // ì—°ë„ ë³€ê²½ ì‹œ
            yearSelect.addEventListener('change', () => {
                const selectedGun = gunSelect.value;
                if (selectedGun) {
                    loadUniversityList(yearSelect.value, selectedGun);
                }
            });

            // êµ° ì„ íƒ ì‹œ
            gunSelect.addEventListener('change', () => {
                const selectedGun = gunSelect.value;
                loadUniversityList(yearSelect.value, selectedGun);

                // ëŒ€í•™ ì„ íƒ ì´ˆê¸°í™”
                document.getElementById('applicants-container').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-university"></i>
                        <h3>ëŒ€í•™ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                        <p>ìœ„ì—ì„œ ëŒ€í•™ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í•™êµ ì§€ì›ì ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                document.getElementById('stats-bar').style.display = 'none';
            });

            // ëŒ€í•™ ì„ íƒ ì‹œ
            universitySelect.addEventListener('change', () => {
                const selectedUID = universitySelect.value;
                if (selectedUID) {
                    loadApplicantsForUniversity(selectedUID, yearSelect.value);
                } else {
                    document.getElementById('applicants-container').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-university"></i>
                            <h3>ëŒ€í•™ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                            <p>ìœ„ì—ì„œ ëŒ€í•™ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í•™êµ ì§€ì›ì ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                    document.getElementById('stats-bar').style.display = 'none';
                }
            });

            // ì •ë ¬ ë³€ê²½ ì‹œ
            sortSelect.addEventListener('change', () => {
                if (currentApplicants.length > 0) {
                    sortApplicants(sortSelect.value);
                }
            });
        });
    </script>
</body>
</html>
